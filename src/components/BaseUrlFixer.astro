---
const isCustomDomain = !import.meta.env.BASE_URL || import.meta.env.BASE_URL === "/";
const baseUrl = import.meta.env.BASE_URL || "";
---

{!isCustomDomain && (
<script define:vars={{ baseUrl }}>
  // Only run this on GitHub Pages with base path (not custom domains)
  document.addEventListener("DOMContentLoaded", () => {
    // Fix preload links
    const preloadLinks = document.querySelectorAll("link[rel=\"preload\"]");
    preloadLinks.forEach(link => {
      const href = link.getAttribute("href");
      if (href && href.startsWith("/") && !href.startsWith(baseUrl) && !href.startsWith("http")) {
        link.setAttribute("href", `${baseUrl}${href}`);
      }
    });

    // Fix font-face rules in stylesheets
    const styleSheets = Array.from(document.styleSheets);
    for (const sheet of styleSheets) {
      try {
        const rules = Array.from(sheet.cssRules || []);
        for (const rule of rules) {
          if (rule.type === CSSRule.FONT_FACE_RULE) {
            const src = rule.style.getPropertyValue("src");
            if (src && src.includes("url(\"/") && !src.includes(`url("${baseUrl}`)) {
              // Update the URL to include the base path
              const newSrc = src.replace("url(\"/", `url("${baseUrl}/`);
              rule.style.setProperty("src", newSrc);
            }
          }
        }
      } catch (e) {
        // Cross-origin stylesheets will throw an error, we can ignore them
        continue;
      }
    }
  });
</script>
)}

<!-- Add direct font-face style for custom domains -->
{isCustomDomain && (
<style is:global>
  @font-face {
    font-family: "Vaticanus";
    src: url("/Vaticanus-G3yVG.ttf") format("truetype");
    font-weight: normal;
    font-style: normal;
    font-display: swap;
  }
</style>
)}

